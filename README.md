# NGX Sales Agent API

API para el Agente de Ventas NGX con IA conversacional que aprovecha OpenAI para procesamiento de lenguaje natural y ElevenLabs para s√≠ntesis de voz.

## Caracter√≠sticas

- üß† **Procesamiento de Lenguaje Natural**: Utiliza GPT-4 para mantener conversaciones contextuales y naturales.
- üó£Ô∏è **S√≠ntesis de Voz Avanzada**: Integraci√≥n con ElevenLabs para generar respuestas de voz naturales y expresivas.
- üíæ **Persistencia en Supabase**: Almacenamiento de conversaciones y datos de clientes en PostgreSQL mediante Supabase.
- üîÑ **Arquitectura As√≠ncrona**: API completamente as√≠ncrona para manejar m√∫ltiples conversaciones simult√°neas.
- üöÄ **Containerizaci√≥n con Docker**: Facilidad de despliegue y desarrollo mediante contenedores.

## Prerrequisitos

- Python 3.10 o superior
- Docker y Docker Compose (opcional, para desarrollo en contenedores)
- Cuenta en OpenAI con API key
- Cuenta en ElevenLabs con API key
- Cuenta en Supabase con proyecto configurado

## Configuraci√≥n

1. Clona este repositorio:
   ```bash
   git clone <url-del-repositorio>
   cd ngx-sales-agent
   ```

2. Crea un archivo `.env` a partir del ejemplo:
   ```bash
   cp env.example .env
   ```

3. Edita el archivo `.env` con tus claves de API y configuraci√≥n:
   ```
   # OpenAI
   OPENAI_API_KEY=tu_api_key_de_openai
   
   # ElevenLabs
   ELEVENLABS_API_KEY=tu_api_key_de_elevenlabs
   
   # Supabase
   SUPABASE_URL=tu_url_de_supabase
   SUPABASE_ANON_KEY=tu_clave_anonima_de_supabase
   SUPABASE_SERVICE_ROLE_KEY=tu_clave_de_servicio_de_supabase
   
   # Configuraci√≥n de la aplicaci√≥n
   DEBUG=True
   LOG_LEVEL=INFO
   ```

4. Configura la base de datos en Supabase:
   ```bash
   python scripts/setup_db.py
   ```

## Desarrollo Local

### Usando Python directamente

1. Crea un entorno virtual e instala las dependencias:
   ```bash
   python -m venv venv
   source venv/bin/activate  # En Windows: venv\Scripts\activate
   pip install -r requirements.txt
   ```

2. Ejecuta la aplicaci√≥n:
   ```bash
   uvicorn src.api.main:app --reload
   ```

### Usando Docker

1. Construye y ejecuta los contenedores:
   ```bash
   docker-compose -f docker/docker-compose.yml up --build
   ```

## API Endpoints

La API estar√° disponible en `http://localhost:8000` con los siguientes endpoints:

- **GET /health**: Verificar que la API est√° funcionando.
- **POST /conversations/start**: Iniciar una nueva conversaci√≥n.
- **POST /conversations/{conversation_id}/message**: Enviar un mensaje a una conversaci√≥n existente.
- **GET /conversations/{conversation_id}/audio**: Obtener el audio de respuesta para el √∫ltimo mensaje del asistente.
- **POST /conversations/{conversation_id}/end**: Finalizar una conversaci√≥n.
- **GET /conversations/{conversation_id}**: Obtener el estado completo de una conversaci√≥n.

Para documentaci√≥n completa de la API, visita `http://localhost:8000/docs` despu√©s de iniciar la aplicaci√≥n.

## Ejemplos de Uso

### Iniciar una conversaci√≥n

```bash
curl -X 'POST' \
  'http://localhost:8000/conversations/start' \
  -H 'Content-Type: application/json' \
  -d '{
    "customer_data": {
      "name": "Juan P√©rez",
      "email": "juan@ejemplo.com",
      "age": 42,
      "gender": "male",
      "occupation": "CEO",
      "goals": {
        "primary": "increase_energy",
        "secondary": ["improve_focus", "stress_management"]
      }
    },
    "program_type": "PRIME"
  }'
```

### Enviar un mensaje

```bash
curl -X 'POST' \
  'http://localhost:8000/conversations/{conversation_id}/message' \
  -H 'Content-Type: application/json' \
  -d '{
    "message": "Me interesa mejorar mi energ√≠a durante el d√≠a."
  }'
```

## Licencia

[MIT](LICENSE) 